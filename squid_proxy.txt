Task:

This ticket involves a review and lockdown of the Squid proxy (Tooling Proxy) access lists so that only connectivity to the security tools public endpoints:

CroudStrike: lfodown01-b.cloudsink.net & ts01-b.cloudsink.net
Tanium: diebold-zsb1.cloud.tanium.com & diebold-zsb2.cloud.tanium.com
 

We need to update the Puppet configuration for Squid to lock it down to this 2 URLs. on both NonLive and Live.

This should be done using the Puppet Squid module already installed: https://github.com/voxpupuli/puppet-squid.git

Code 

In Puppet hiredata i have added the following code

squid::acls:
  'allowed_sites':
    type: 'dstdomain'
    entries:
      - 'lfodown01-b.cloudsink.net'
      - 'ts01-b.cloudsink.net' 
      - 'diebold-zsb1.cloud.tanium.com'
      - 'diebold-zsb2.cloud.tanium.com'

Added proxy on the server
export http_proxy="http://localhost:3128"
export https_proxy="http://localhost:3128"
export ftp_proxy="http://localhost:3128"
export no_proxy="localhost,127.0.0.1"

if i run curl or wget its not going through

[root@tooling_hapee-i0d845f30f11e0fae6 manishin]# wget -e use_proxy=yes -e http_proxy=http://localhost:3128 http://diebold-zsb1.cloud.tanium.com
--2024-10-11 12:05:22--  http://diebold-zsb1.cloud.tanium.com/
Resolving localhost (localhost)... 127.0.0.1
Connecting to localhost (localhost)|127.0.0.1|:3128... connected.
Proxy request sent, awaiting response... 503 Service Unavailable
2024-10-11 12:06:22 ERROR 503: Service Unavailable.


Here is my squid.conf file looks like

[root@tooling_hapee-i0d845f30f11e0fae6 manishin]# cat /etc/squid/squid.conf
#
# squid.conf.header.erb file fragment generated with puppet.
#

cache_mem                     256 MB

maximum_object_size_in_memory 512 KB


access_log                    daemon:/var/log/squid/access.log squid





# acl fragment for allowed_sites
acl allowed_sites dstdomain diebold-zsb1.cloud.tanium.com
acl allowed_sites dstdomain diebold-zsb2.cloud.tanium.com
acl allowed_sites dstdomain lfodown01-b.cloudsink.net
acl allowed_sites dstdomain ts01-b.cloudsink.net

# acl fragment for SSL_ports
acl SSL_ports port 443

# acl fragment for Safe_ports
acl Safe_ports port 443
acl Safe_ports port 80

# acl fragment for localnet
acl localnet src 10.0.0.0/8
acl localnet src 172.16.0.0/12
acl localnet src 192.168.0.0/16

# http_access fragment for SSL_ports
http_access allow SSL_ports

# http_access fragment for Safe_ports
http_access allow Safe_ports

# Our local host is allowed
http_access allow localhost

# Our local networks are allowed
http_access allow localnet

# http_access fragment for !SSL_ports
http_access deny !SSL_ports

# http_access fragment for !Safe_ports
http_access deny !Safe_ports

# fragment for http_port 3128
http_port 3128

